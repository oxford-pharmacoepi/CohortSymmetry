<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CohortSymmetry">
<title>Step 1. Generate a sequence cohort • CohortSymmetry</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Step 1. Generate a sequence cohort">
<meta property="og:description" content="CohortSymmetry">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CohortSymmetry</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a01_Introduction.html">Introduction to CohortSymmetry</a>
    <a class="dropdown-item" href="../articles/a02_Generate_a_sequence_cohort_set.html">Step 1. Generate a sequence cohort</a>
    <a class="dropdown-item" href="../articles/a03_Summarise_sequence_ratio.html">Step 2. Obtain the sequence ratios</a>
    <a class="dropdown-item" href="../articles/a04_Visualise_results.html">Step 3. Visualise the results</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Step 1. Generate a sequence cohort</h1>
            
      
      
      <div class="d-none name"><code>a02_Generate_a_sequence_cohort_set.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we will explore the functionalities of
<code>generateSequenceCohort()</code>.</p>
<div class="section level3">
<h3 id="create-a-cdm-object">Create a cdm object<a class="anchor" aria-label="anchor" href="#create-a-cdm-object"></a>
</h3>
<p>CohortSymmetry package is designed to work with data mapped to OMOP,
so the first step is to create a reference to the data using the
CDMConnector package. We will use the Eunomia dataset for the subsequent
examples.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CDMConnector/" class="external-link">CDMConnector</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://oxford-pharmacoepi.github.io/CohortSymmetry/">CohortSymmetry</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                     dbdir <span class="op">=</span> <span class="fu">CDMConnector</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/eunomiaDir.html" class="external-link">eunomia_dir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdm_from_con.html" class="external-link">cdm_from_con</a></span><span class="op">(</span></span>
<span>  con <span class="op">=</span> <span class="va">db</span>,</span>
<span>  cdm_schema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  write_schema <span class="op">=</span> <span class="st">"main"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="instantiate-two-cohorts-in-the-cdm-reference">Instantiate two cohorts in the cdm reference<a class="anchor" aria-label="anchor" href="#instantiate-two-cohorts-in-the-cdm-reference"></a>
</h3>
<p>CohortSymmetry package requires that the cdm object contains two
cohort tables: one for the index cohort and the other one for the marker
cohort. There are a lot of different ways to create these cohorts, and
it will depend on what the index cohort and marker cohort represent.
Here, we use the DrugUtilisation package to generate two drug cohorts in
the cdm object. For illustrative purposes, we will carry out SSA on
aspirin (index_cohort) against acetaminophen (marker_cohort).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu-dev.github.io/DrugUtilisation/" class="external-link">DrugUtilisation</a></span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu">DrugUtilisation</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu-dev.github.io/DrugUtilisation/reference/generateIngredientCohortSet.html" class="external-link">generateIngredientCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  ingredient <span class="op">=</span> <span class="st">"aspirin"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu">DrugUtilisation</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu-dev.github.io/DrugUtilisation/reference/generateIngredientCohortSet.html" class="external-link">generateIngredientCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  ingredient <span class="op">=</span> <span class="st">"acetaminophen"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="generate-a-sequence-cohort">Generate a sequence cohort<a class="anchor" aria-label="anchor" href="#generate-a-sequence-cohort"></a>
</h2>
<p>In order to initiate the calculations, the two cohorts tables need to
be intersected using <code><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet()</a></code>. This
process will output all the individuals who appear on both tables. Let’s
go through a few examples to see how this function works.</p>
<div class="section level3">
<h3 id="no-specific-requirements">No specific requirements<a class="anchor" aria-label="anchor" href="#no-specific-requirements"></a>
</h3>
<p>Let’s study the simplest case, where no study period, prior history,
washout window, or time gap between the index and the marker, are
specified. See figure below to see an example of a dataset containing
five different participants.</p>
<center>
<p><img src="figures/1-NoRestrictions.png" width="80%"></p>
</center>
<p>See that only the first event or episode (either for the index and
the marker) is included in the analysis. As there is no restriction
criteria and all the individuals have an episode in the index and the
marker cohort, all the subjects are included in the database. We can get
a sequence cohort without including any particular requirement like
so:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>  combinationWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">intercept</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; Database: DuckDB v0.10.2 [unknown@Linux 6.5.0-1018-azure:R 4.4.0//tmp/RtmpqlrTNQ/file1902e5c6c8b.duckdb]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></span>
<span><span class="co">#&gt; $ subject_id           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 6, 16, 42, 40, 53, 49, 11, 32, 12, 17, 63, 30, 36…</span></span>
<span><span class="co">#&gt; $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1965-06-23, 1972-04-10, 1914-07-09, 1952-11-29, …</span></span>
<span><span class="co">#&gt; $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1969-12-20, 1974-06-11, 1937-09-07, 1964-12-28, …</span></span>
<span><span class="co">#&gt; $ index_date           <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1965-06-23, 1972-04-10, 1914-07-09, 1952-11-29, …</span></span>
<span><span class="co">#&gt; $ marker_date          <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1969-12-20, 1974-06-11, 1937-09-07, 1964-12-28, …</span></span></code></pre></div>
<p>See that the generated table has the format of an OMOP CDM cohort,
but it also includes two additional columns: the index_date and the
marker_date, which are the dates of the index and marker episode,
respectively. The cohort_start_date and the cohort_end_date are defined
as:</p>
<ul>
<li>
<strong>cohort_start_date</strong>: earliest cohort_start_date
between the index and the marker events.</li>
<li>
<strong>cohort_end_date</strong>: latest cohort_end_date between the
index and the marker events.</li>
</ul>
<p>If we had more than one cohort in the index or the marker tables, we
would be able to specify the one of interest by using
<code>indexId</code> and <code>markerId</code> arguments.</p>
</div>
<div class="section level3">
<h3 id="specified-study-period">Specified study period<a class="anchor" aria-label="anchor" href="#specified-study-period"></a>
</h3>
<p>We can restrict the study period of the analysis to only include
episodes or events happening during a specific period of time. Hence,
the observation period will be restricted to these dates and only events
or episodes happening during this period will be accounted for the
analysis, as represented in the below figure:</p>
<center>
<p><img src="figures/2-studyPeriod.png" width="80%"></p>
</center>
<p>Notice that, by imposing a restriction on study period, some of the
participants might be excluded. The study period can be restricted using
the <code>cohortDateRange</code> argument, which is defined as:</p>
<center>
<p><code>cohortDateRange = c(start_of_the_study_period, end_of_the_study_period)</code></p>
</center>
<p>See an example of the usage below, where we have restricted the
<code>cohortDateRange</code> within 01/01/1950 until 01/01/1969.
Consequently, the cohort range falls into the pre-specified period:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1969-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  combinationWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">intercept</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>min_cohort_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">cohort_start_date</span><span class="op">)</span>, </span>
<span>            max_cohort_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cohort_start_date</span><span class="op">)</span>,</span>
<span>            min_cohort_end_date   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">cohort_end_date</span><span class="op">)</span>,</span>
<span>            max_cohort_end_date   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cohort_end_date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB v0.10.2 [unknown@Linux 6.5.0-1018-azure:R 4.4.0//tmp/RtmpqlrTNQ/file1902e5c6c8b.duckdb]</span></span>
<span><span class="co">#&gt; $ min_cohort_start_date <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1950-01-02</span></span>
<span><span class="co">#&gt; $ max_cohort_start_date <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1968-09-08</span></span>
<span><span class="co">#&gt; $ min_cohort_end_date   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1950-07-19</span></span>
<span><span class="co">#&gt; $ max_cohort_end_date   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1969-01-01</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specified-study-period-and-prior-history-requirement">Specified study period and prior history requirement<a class="anchor" aria-label="anchor" href="#specified-study-period-and-prior-history-requirement"></a>
</h3>
<p>We can also specify the minimum prior history that an individual has
to have before the start of the first event. Individuals with not enough
prior history will be excluded. See the figure below, where we have
excluded individual number 5 because the first event happening within
the study period did not have more than 31 days of prior history:</p>
<center>
<img src="figures/3-PriorObservation.png" width="80%">
</center>
<p>The number of days of prior history required can be implemented using
the argument <code>daysPriorObservation</code>. See an example below,
where we focus on two different individuals: subjects 2 and 53. Without
a prior history requirement, both individuals are included in the
analysis:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1969-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  daysPriorObservation <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  combinationWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">intercept</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">cdm</span><span class="op">$</span><span class="va">observation_period</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"subject_id"</span> <span class="op">=</span> <span class="st">"person_id"</span>, <span class="st">"observation_period_start_date"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">53</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>daysPriorObservation <span class="op">=</span> <span class="va">cohort_start_date</span> <span class="op">-</span> <span class="va">observation_period_start_date</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 8</span></span>
<span><span class="co">#&gt; Database: DuckDB v0.10.2 [unknown@Linux 6.5.0-1018-azure:R 4.4.0//tmp/RtmpqlrTNQ/file1902e5c6c8b.duckdb]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1</span></span>
<span><span class="co">#&gt; $ subject_id                    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 53, 2</span></span>
<span><span class="co">#&gt; $ cohort_start_date             <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1962-12-13, 1952-07-13</span></span>
<span><span class="co">#&gt; $ cohort_end_date               <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1965-05-01, 1955-10-22</span></span>
<span><span class="co">#&gt; $ index_date                    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1965-05-01, 1952-07-13</span></span>
<span><span class="co">#&gt; $ marker_date                   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1962-12-13, 1955-10-22</span></span>
<span><span class="co">#&gt; $ observation_period_start_date <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1962-08-15, 1920-06-01</span></span>
<span><span class="co">#&gt; $ daysPriorObservation          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 120, 11730</span></span></code></pre></div>
<p>Now we impose a prior history requirement of 365 days. As seen,
subject 53 is excluded as it does not have enough days (&gt;365) of
prior observation before the included event.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1980-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  daysPriorObservation <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  combinationWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">intercept</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">cdm</span><span class="op">$</span><span class="va">observation_period</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"subject_id"</span> <span class="op">=</span> <span class="st">"person_id"</span>, <span class="st">"observation_period_start_date"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">53</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; Database: DuckDB v0.10.2 [unknown@Linux 6.5.0-1018-azure:R 4.4.0//tmp/RtmpqlrTNQ/file1902e5c6c8b.duckdb]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1</span></span>
<span><span class="co">#&gt; $ subject_id                    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2</span></span>
<span><span class="co">#&gt; $ cohort_start_date             <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1952-07-13</span></span>
<span><span class="co">#&gt; $ cohort_end_date               <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1955-10-22</span></span>
<span><span class="co">#&gt; $ index_date                    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1952-07-13</span></span>
<span><span class="co">#&gt; $ marker_date                   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1955-10-22</span></span>
<span><span class="co">#&gt; $ observation_period_start_date <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1920-06-01</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specified-study-period-prior-history-requirement-and-washout-period">Specified study period, prior history requirement and washout
period<a class="anchor" aria-label="anchor" href="#specified-study-period-prior-history-requirement-and-washout-period"></a>
</h3>
We can also specify the minimum washout period required for an event or
episode to be included. In the following figure, we exclude participant
number 6 as another episode took place within the washout period:
<center>
<img src="figures/4-washoutPeriod.png" width="80%">
</center>
<p>This functionality can be implemented using the
<code>washoutWindow</code> argument. See an example of its
implementation below, where we analyse the case of subject_id number
1936 and 3565.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1980-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  daysPriorObservation <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  washoutWindow <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  combinationWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">[[</span><span class="st">"aspirin"</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1936</span>,<span class="fl">3565</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">subject_id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">cohort_start_date</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:     SQL [6 x 4]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database:   DuckDB v0.10.2 [unknown@Linux 6.5.0-1018-azure:R 4.4.0//tmp/RtmpqlrTNQ/file1902e5c6c8b.duckdb]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:     subject_id</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Ordered by: cohort_start_date</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1       <span style="text-decoration: underline;">1</span>936 1949-10-08        1949-11-05     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1       <span style="text-decoration: underline;">1</span>936 1950-05-06        1950-05-20     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                    1       <span style="text-decoration: underline;">1</span>936 1955-08-04        1955-08-25     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>                    1       <span style="text-decoration: underline;">3</span>565 1950-01-02        1950-01-30     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>                    1       <span style="text-decoration: underline;">3</span>565 1957-11-19        1957-12-24     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>                    1       <span style="text-decoration: underline;">3</span>565 1945-12-24        1946-01-07</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">[[</span><span class="st">"intercept"</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1936</span>,<span class="fl">3565</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; Database: DuckDB v0.10.2 [unknown@Linux 6.5.0-1018-azure:R 4.4.0//tmp/RtmpqlrTNQ/file1902e5c6c8b.duckdb]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1</span></span>
<span><span class="co">#&gt; $ subject_id           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1936, 3565</span></span>
<span><span class="co">#&gt; $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1950-05-06, 1950-01-02</span></span>
<span><span class="co">#&gt; $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1951-09-26, 1951-08-27</span></span>
<span><span class="co">#&gt; $ index_date           <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1950-05-06, 1950-01-02</span></span>
<span><span class="co">#&gt; $ marker_date          <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1951-09-26, 1951-08-27</span></span></code></pre></div>
<p>Notice that by setting a washout window of 0, both participants are
included. However, see that the included episode of subject 1936 happens
at 1950-05-06, and a previous episode (not included within the study
period), happened just 210 days before this one (1949-10-08). Hence, by
using a <code>washoutWindow</code> of 365, this participant is excluded
from the analysis:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1969-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  daysPriorObservation <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  washoutWindow <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  combinationWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">[[</span><span class="st">"intercept"</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1936</span>,<span class="fl">3565</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">subject_id</span>, <span class="va">cohort_start_date</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; Database: DuckDB v0.10.2 [unknown@Linux 6.5.0-1018-azure:R 4.4.0//tmp/RtmpqlrTNQ/file1902e5c6c8b.duckdb]</span></span>
<span><span class="co">#&gt; Ordered by: subject_id, cohort_start_date</span></span>
<span><span class="co">#&gt; $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1</span></span>
<span><span class="co">#&gt; $ subject_id           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 3565</span></span>
<span><span class="co">#&gt; $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1950-01-02</span></span>
<span><span class="co">#&gt; $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1951-08-27</span></span>
<span><span class="co">#&gt; $ index_date           <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1950-01-02</span></span>
<span><span class="co">#&gt; $ marker_date          <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1951-08-27</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specified-study-period-prior-history-requirement-and-combination-window">Specified study period, prior history requirement and combination
window<a class="anchor" aria-label="anchor" href="#specified-study-period-prior-history-requirement-and-combination-window"></a>
</h3>
<p>We define the combination window as the minimum and the maximum days
between the start of the first event (either if is the index or the
marker) and the start of the next event. In other words:</p>
<center>
<p>x = second_episode(start_date) - first_episode(start_date)</p>
<p>combinationWindow[1] <span class="math inline">\(\leq\)</span> x
<span class="math inline">\(\leq\)</span> combinationWindow[2]</p>
</center>
See in the figure below an example, where we define
<code>combinationWindow = c(0,20)</code>. This means that the gap
between the start date of the second episode and the start of the first
episode should be larger than 0 and less or equal than 20. As subjects 2
and 3 do not fulfill this condition, they are excluded from the
analysis.
<center>
<img src="figures/5-combinationWindow_numbers.png" width="80%">
</center>
<p>In the <code><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet()</a></code>function, this is
implemented using the <code>combinationWindow</code> argument. Notice
that in the previous examples, as we did not want any combination window
requirement, we have set this argument to
<code>combinationWindow = c(0,Inf)</code>, as by default is
<code>combinationWindow = c(0, 365)</code>. In the following example, we
explore subject_id 80 and 187 to see the functionality of this argument.
When using no restriction for the combination window, both are included
in the <strong>intersect</strong> cohort:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1969-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  daysPriorObservation <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  combinationWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">[[</span><span class="st">"intercept"</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>,<span class="fl">187</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>combinationWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">index_date</span>, <span class="va">marker_date</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">index_date</span>, <span class="va">marker_date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [2 x 7]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v0.10.2 [unknown@Linux 6.5.0-1018-azure:R 4.4.0//tmp/RtmpqlrTNQ/file1902e5c6c8b.duckdb]</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date index_date</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1         80 1953-02-24        1953-12-31      1953-12-31</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1        187 1957-04-20        1965-10-07      1957-04-20</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: marker_date &lt;date&gt;, combinationWindow &lt;dbl&gt;</span></span></span></code></pre></div>
<p>However, when restricting a maximum combination window of 365 days,
subject 187 is excluded from the analysis, as its
<code>combinationWindow</code> is larger than 365:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1969-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  daysPriorObservation <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  combinationWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">[[</span><span class="st">"intercept"</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>,<span class="fl">187</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [2 x 6]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v0.10.2 [unknown@Linux 6.5.0-1018-azure:R 4.4.0//tmp/RtmpqlrTNQ/file1902e5c6c8b.duckdb]</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date index_date</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1         80 1953-02-24        1953-12-31      1953-12-31</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1        187 1957-04-20        1965-10-07      1957-04-20</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: marker_date &lt;date&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specified-study-period-prior-history-requirement-and-index-gap">Specified study period, prior history requirement and index gap<a class="anchor" aria-label="anchor" href="#specified-study-period-prior-history-requirement-and-index-gap"></a>
</h3>
<p>We define the index-marker gap to refer to the maximum number of days
between the start of the second episode (either if is the index or the
marker) and the end of the first episode. That means:</p>
<center>
<p>x = second_episode(cohort_start_date) -
first_episode(cohort_end_date)</p>
<p>x <span class="math inline">\(\leq\)</span> indexMarkerGap</p>
</center>
<p>See an example below, where all subjects with an index-marker gap
higher than 30 days are excluded from the analysis:</p>
<center>
<img src="figures/6-indexGap.png" width="80%">
</center>
<p>Use <code>indexGap</code> argument to impose this restriction. See
how this affect subject 80 and 754 in the example below:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1969-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  daysPriorObservation <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  indexMarkerGap <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">intercept</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>,<span class="fl">754</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># As for both, acetaminophen (marker) is the first event:</span></span>
<span>    <span class="va">cdm</span><span class="op">[[</span><span class="st">"acetaminophen"</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"subject_id"</span>, </span>
<span>             <span class="st">"marker_date"</span> <span class="op">=</span> <span class="st">"cohort_start_date"</span>, </span>
<span>             <span class="st">"first_episode_end_date"</span> <span class="op">=</span> <span class="st">"cohort_end_date"</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subject_id"</span>, <span class="st">"marker_date"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">cdm</span><span class="op">[[</span><span class="st">"aspirin"</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"subject_id"</span>, </span>
<span>             <span class="st">"index_date"</span> <span class="op">=</span> <span class="st">"cohort_start_date"</span>,</span>
<span>             <span class="st">"second_episode_start_date"</span> <span class="op">=</span> <span class="st">"cohort_start_date"</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subject_id"</span>, <span class="st">"index_date"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>indexMarkerGap <span class="op">=</span> <span class="va">second_episode_start_date</span> <span class="op">-</span> <span class="va">first_episode_end_date</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [2 x 9]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v0.10.2 [unknown@Linux 6.5.0-1018-azure:R 4.4.0//tmp/RtmpqlrTNQ/file1902e5c6c8b.duckdb]</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date index_date</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1        754 1950-08-12        1950-09-20      1950-09-20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1         80 1953-02-24        1953-12-31      1953-12-31</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: marker_date &lt;date&gt;, first_episode_end_date &lt;date&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   second_episode_start_date &lt;date&gt;, indexMarkerGap &lt;dbl&gt;</span></span></span></code></pre></div>
<p>By using a <code>indexMarkerGap = 30</code>, subject 80 is excluded
from the analysis, as is index-marker gap is larger than 30:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intercept"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1969-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  daysPriorObservation <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  indexMarkerGap <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">intercept</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>,<span class="fl">754</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [1 x 6]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v0.10.2 [unknown@Linux 6.5.0-1018-azure:R 4.4.0//tmp/RtmpqlrTNQ/file1902e5c6c8b.duckdb]</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date index_date</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1        754 1950-08-12        1950-09-20      1950-09-20</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: marker_date &lt;date&gt;</span></span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Xihang Chen, Tyman Stanford, Berta Raventós, Nicole Pratt, Ed Burn, Marti Català, Danielle Newby, Núria Mercadé-Besora, Mike Du, Yuchen Guo, Kim Lopez, Marta Alcalde-Herraiz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
