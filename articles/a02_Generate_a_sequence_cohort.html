<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Step 1. Generate a sequence cohort • CohortSymmetry</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Step 1. Generate a sequence cohort">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CohortSymmetry</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3.900</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a01_Introduction.html">Introduction to CohortSymmetry</a></li>
    <li><a class="dropdown-item" href="../articles/a02_Generate_a_sequence_cohort.html">Step 1. Generate a sequence cohort</a></li>
    <li><a class="dropdown-item" href="../articles/a03_Summarise_sequence_ratios.html">Step 2. Obtain the sequence ratios</a></li>
    <li><a class="dropdown-item" href="../articles/a04_Visualise_sequence_ratios.html">Step 3. Visualise the sequence ratios</a></li>
    <li><a class="dropdown-item" href="../articles/a05_Summarise_temporal_symmetry.html">Step 4: Obtain aggregated data on temporal symmetry</a></li>
    <li><a class="dropdown-item" href="../articles/a06_Visualise_temporal_symmetry.html">Step 5: Visualise temporal symmetry</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/oxford-pharmacoepi/CohortSymmetry/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Step 1. Generate a sequence cohort</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/oxford-pharmacoepi/CohortSymmetry/blob/main/vignettes/a02_Generate_a_sequence_cohort.Rmd" class="external-link"><code>vignettes/a02_Generate_a_sequence_cohort.Rmd</code></a></small>
      <div class="d-none name"><code>a02_Generate_a_sequence_cohort.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we will explore the functionalities of
<code>generateSequenceCohort()</code>.</p>
<div class="section level3">
<h3 id="create-a-cdm-object">Create a cdm object<a class="anchor" aria-label="anchor" href="#create-a-cdm-object"></a>
</h3>
<p>CohortSymmetry package is designed to work with data mapped to OMOP,
so the first step is to create a reference to the data using the
CDMConnector package. We will use the Eunomia dataset for the subsequent
examples.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CDMConnector/" class="external-link">CDMConnector</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://oxford-pharmacoepi.github.io/CohortSymmetry/">CohortSymmetry</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                     dbdir <span class="op">=</span> <span class="fu">CDMConnector</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/eunomiaDir.html" class="external-link">eunomia_dir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdm_from_con.html" class="external-link">cdm_from_con</a></span><span class="op">(</span></span>
<span>  con <span class="op">=</span> <span class="va">db</span>,</span>
<span>  cdm_schema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  write_schema <span class="op">=</span> <span class="st">"main"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="instantiate-two-cohorts-in-the-cdm-reference">Instantiate two cohorts in the cdm reference<a class="anchor" aria-label="anchor" href="#instantiate-two-cohorts-in-the-cdm-reference"></a>
</h3>
<p>CohortSymmetry package requires that the cdm object contains two
cohort tables: the index cohort and the marker cohort. There are a lot
of different ways to create these cohorts, and it will depend on what
the index cohort and marker cohort represent. Here, we use the
DrugUtilisation package to generate two drug cohorts in the cdm object.
For illustrative purposes, we will carry out SSA on aspirin
(index_cohort) against acetaminophen (marker_cohort).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu-dev.github.io/DrugUtilisation/" class="external-link">DrugUtilisation</a></span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu">DrugUtilisation</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu-dev.github.io/DrugUtilisation/reference/generateIngredientCohortSet.html" class="external-link">generateIngredientCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  ingredient <span class="op">=</span> <span class="st">"aspirin"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu">DrugUtilisation</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu-dev.github.io/DrugUtilisation/reference/generateIngredientCohortSet.html" class="external-link">generateIngredientCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  ingredient <span class="op">=</span> <span class="st">"acetaminophen"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="generate-a-sequence-cohort">Generate a sequence cohort<a class="anchor" aria-label="anchor" href="#generate-a-sequence-cohort"></a>
</h2>
<p>In order to initiate the calculations, the two cohorts tables need to
be intersected using <code><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet()</a></code>. This
process will output all the individuals who appear on both tables
subject to different parameters. Each parameter corresponds to a
specific requirement. The parameters for this function include
<code>cohortDateRange</code>, <code>daysPriorObservation</code>,
<code>washoutWindow</code>, <code>indexMarkerGap</code> and
<code>combinationWindow</code>. Let’s go through examples to see how
each parameter works.</p>
<div class="section level3">
<h3 id="no-specific-requirements">No specific requirements<a class="anchor" aria-label="anchor" href="#no-specific-requirements"></a>
</h3>
<p>Let’s study the simplest case where no requirements are imposed. See
figure below to see an example of an analysis containing six different
participants.</p>
<center>
<p><img src="1-NoRestrictions.png" width="80%"></p>
</center>
<p>See that only the first event/episode (for both the index and the
marker) is included in the analysis. As there is no restriction criteria
and all the individuals have an episode in the index and the marker
cohort, all the subjects are included in the analysis. We can get a
sequence cohort without including any particular requirement like
so:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intersect"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>, <span class="co">#default</span></span>
<span>  daysPriorObservation <span class="op">=</span> <span class="fl">0</span>, <span class="co">#default</span></span>
<span>  washoutWindow <span class="op">=</span> <span class="fl">0</span>, <span class="co">#default</span></span>
<span>  indexMarkerGap <span class="op">=</span> <span class="cn">NULL</span>, <span class="co">#default</span></span>
<span>  combinationWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">Inf</span><span class="op">)</span><span class="op">)</span> <span class="co"># default</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">intersect</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1//tmp/RtmpWKX1m0/file191970a43f21.duckdb]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></span>
<span><span class="co">#&gt; $ subject_id           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 42, 35, 2, 49, 11, 43, 12, 7, 17, 5, 30, 3, 57, 1…</span></span>
<span><span class="co">#&gt; $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1914-07-09, 1960-06-20, 1920-07-01, 1976-11-13, …</span></span>
<span><span class="co">#&gt; $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1937-09-07, 1993-04-28, 1931-09-03, 1978-03-10, …</span></span>
<span><span class="co">#&gt; $ index_date           <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1914-07-09, 1993-04-28, 1920-07-01, 1976-11-13, …</span></span>
<span><span class="co">#&gt; $ marker_date          <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1937-09-07, 1960-06-20, 1931-09-03, 1978-03-10, …</span></span></code></pre></div>
<div class="section level4">
<h4 id="important-observations">Important Observations<a class="anchor" aria-label="anchor" href="#important-observations"></a>
</h4>
<p>See that the generated table has the format of an OMOP CDM cohort,
but it also includes two additional columns: the <code>index_date</code>
and the <code>marker_date</code>, which are the
<code>cohort_start_date</code> of the index and marker episode
respectively. The cohort_start_date and the <code>cohort_end_date</code>
are defined as:</p>
<ul>
<li>
<strong><code>cohort_start_date</code></strong>: earliest
<code>cohort_start_date</code> between the index and the marker
events.</li>
<li>
<strong><code>cohort_end_date</code></strong>: latest
<code>cohort_start_date</code> between the index and the marker
events.</li>
</ul>
<p>The <code>cohort_definition_id</code> in the output is associated
with the <code>cohort_definition_id}</code> of the index table
(<code>indexId</code>) and the <code>cohort_definition_id</code> of the
marker table (<code>markerId</code>). To see the correspondence, one
could do the following:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">intersect</span>, <span class="st">"cohort_set"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;main.intersect_set&gt; [1 x 13]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1//tmp/RtmpWKX1m0/file191970a43f21.duckdb]</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id cohort_name     index_id index_name marker_id marker_name</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1 index_1191_asp…        1 1191_aspi…         1 161_acetam…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables: cohort_date_range &lt;chr&gt;, days_prior_observation &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   washout_window &lt;dbl&gt;, index_marker_gap &lt;chr&gt;, combination_window &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   moving_average_restriction &lt;dbl&gt;, nsr &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The user may also wish to subset the index table and marker table
based on their cohort_definition_id using <code>indexId</code> and
<code>markerId</code> respectively. For example, the following code only
includes <code>cohort_definidtion_id</code>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">= 1</annotation></semantics></math>
from both the index and the marker table.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intersect"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  indexId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  markerId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  daysPriorObservation <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  washoutWindow <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  indexMarkerGap <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  combinationWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="specified-study-period">Specified study period<a class="anchor" aria-label="anchor" href="#specified-study-period"></a>
</h3>
<p>We can restrict the study period of the analysis to only include
episodes or events happening during a specific period of time. See
figure below to see an example of an analysis containing six different
participants.</p>
<center>
<p><img src="2-studyPeriod.png" width="80%"></p>
</center>
<p>Notice that, by imposing a restriction on study period, some of the
participants might be excluded. For example, participant 4 is excluded
because the only index episode is outside of the study period whereas
participant 6 is included because he/she does have an index episode
within the study period.</p>
<p>The study period can be restricted using the
<code>cohortDateRange</code> argument, which is defined as:</p>
<center>
<p><code>cohortDateRange = c(start_of_the_study_period, end_of_the_study_period)</code></p>
</center>
<p>See an example of the usage below, where we have restricted the
<code>cohortDateRange</code> within 01/01/1950 until 01/01/1969.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intersect_study_period"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1969-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specified-study-period-and-prior-history-requirement">Specified study period and prior history requirement<a class="anchor" aria-label="anchor" href="#specified-study-period-and-prior-history-requirement"></a>
</h3>
<p>We can also specify the minimum prior history that an individual has
to have before the start of the first event. Individuals with not enough
prior history will be excluded. See the figure below, imagine the prior
observation history is set to be 31 days, then participant 5 would be
excluded because the first event happening within the study period does
not have more than (or equal to) 31 days of prior history:</p>
<center>
<img src="3-PriorObservation.png" width="80%">
</center>
<p>The number of days of prior history required can be implemented using
the argument <code>daysPriorObservation</code>. See an example
below:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>   cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>   indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>   markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>   name <span class="op">=</span> <span class="st">"intersect_prior_obs"</span>,</span>
<span>   cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1969-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>   daysPriorObservation <span class="op">=</span> <span class="fl">365</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specified-study-period-prior-history-requirement-and-washout-period">Specified study period, prior history requirement and washout
period<a class="anchor" aria-label="anchor" href="#specified-study-period-prior-history-requirement-and-washout-period"></a>
</h3>
<p>We can also specify the minimum washout period required for an event
or episode to be included. In the following figure, we exclude
participant 6 as another episode took place within the washout period.
Washout period is applied to index and marker respectively.</p>
<center>
<img src="4-washoutPeriod.png" width="80%">
</center>
<p>This functionality can be implemented using the
<code>washoutWindow</code> argument. See an example below:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intersect_washout"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1969-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  daysPriorObservation <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  washoutWindow <span class="op">=</span> <span class="fl">365</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specified-study-period-prior-history-requirement-and-combination-window">Specified study period, prior history requirement and combination
window<a class="anchor" aria-label="anchor" href="#specified-study-period-prior-history-requirement-and-combination-window"></a>
</h3>
<p>We define the combination window as the minimum and the maximum days
between the start of the first event (either if is the index or the
marker) and the start of the next event. In other words:</p>
<center>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">x =</annotation></semantics></math><code>second_episode(start_date)</code>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>−</mo><annotation encoding="application/x-tex">-</annotation></semantics></math><code>first_episode(start_date)</code>;</p>
<p><code>combinationWindow[1]</code>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>x</mi><mo>≤</mo></mrow><annotation encoding="application/x-tex">&lt; x \leq</annotation></semantics></math><code>combinationWindow[2]</code></p>
</center>
See in the figure below an example, where we define
<code>combinationWindow = c(0,20)</code>. This means that the gap
between the start date of the second episode and the start of the first
episode should be larger than 0 and less or equal than 20. As
participant 2 and 3 do not fulfill this condition, they are excluded
from the analysis.
<center>
<img src="5-combinationWindow_numbers.png" width="80%">
</center>
<p>In the <code><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet()</a></code> function, this is
implemented using the <code>combinationWindow</code> argument. Notice
that in the previous examples, as we did not want any combination window
requirement, we have set this argument to
<code>combinationWindow = c(0,Inf)</code>, as by default is
<code>combinationWindow = c(0, 365)</code>. In the following example, we
explore subject_id 80 and 187 to see the functionality of this argument.
When using no restriction for the combination window, both are included
in the <strong>intersect_changed_cw</strong> cohort:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>   cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>   indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>   markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>   name <span class="op">=</span> <span class="st">"intersect_changed_cw"</span>,</span>
<span>   cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1969-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>   daysPriorObservation <span class="op">=</span> <span class="fl">365</span>,</span>
<span>   combinationWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span> <span class="va">cdm</span><span class="op">$</span><span class="va">intersect_changed_cw</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>,<span class="fl">187</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>combinationWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">index_date</span>, <span class="va">marker_date</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">index_date</span>, <span class="va">marker_date</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specified-study-period-prior-history-requirement-and-index-marker-gap">Specified study period, prior history requirement and index marker
gap<a class="anchor" aria-label="anchor" href="#specified-study-period-prior-history-requirement-and-index-marker-gap"></a>
</h3>
<p>We define the index-marker gap to refer to the maximum number of days
between the start of the second episode and the end of the first
episode. That means:</p>
<center>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">x =</annotation></semantics></math><code>second_episode(cohort_start_date)</code>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>−</mo><annotation encoding="application/x-tex">-</annotation></semantics></math><code>first_episode(cohort_end_date)</code>;</p>
<p>x
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>≤</mo><annotation encoding="application/x-tex">\leq</annotation></semantics></math><code>indexMarkerGap</code></p>
</center>
<p>See an example below, where all participants with an index-marker gap
higher than 30 days are excluded from the analysis (participant 2, 3 and
6):</p>
<center>
<img src="6-indexGap.png" width="80%">
</center>
<p>Use <code>indexGap</code> argument to impose this restriction, for
example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateSequenceCohortSet.html">generateSequenceCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  indexTable <span class="op">=</span> <span class="st">"aspirin"</span>,</span>
<span>  markerTable <span class="op">=</span> <span class="st">"acetaminophen"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"intersect_"</span>,</span>
<span>  cohortDateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1950-01-01"</span>,<span class="st">"1969-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  daysPriorObservation <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  indexMarkerGap <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">CDMConnector</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmDisconnect.html" class="external-link">cdmDisconnect</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Xihang Chen, Tyman Stanford, Berta Raventós, Nicole Pratt, Ed Burn, Marti Català, Danielle Newby, Núria Mercadé-Besora, Mike Du, Yuchen Guo, Kim Lopez, Marta Alcalde-Herraiz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
